<!DOCTYPE html>
<html lang="fr">

<head>
    <title>Gestions des fournisseurs</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta name="author" content="PAGE Lilian" />
    <meta name="description" content="Statistique" />
    <script src="scriptCommun.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <header>
        <div class=" sidebar" id="mySidebar">
            <button class="bar-item button" onclick="sidebar_close()">Close &times;</button>
            <a href="commande.php" class="bar-item button">Commande</a><br>
            <a href="recette.php" class="bar-item button">Link 2</a><br>
            <a href="#" class="bar-item button">Link 3</a>
        </div>
        <button class="button left hide-large" onclick="sidebar_open()">&#9776;</button>
        <div class="right logo">
            <img src="./img/logo.png" class="text-center" alt="" width="100px" height="100px" />
        </div>
        <div>
            <br><br><br><br><br>
            <h1 id="TitreDuSite" class="titre text-center">Gestions des fournisseurs</h1>
        </div>
        <div id="tabfournisseur">

        </div>
        <div>
            <button type='button' class="button titre text-center" id='NewFournisseur'
                onclick="location.href = 'Creation Fournisseur.html'">
                Créé un nouveau fournisseur</input>
        </div>
    </header>


    <script>
        $.ajax({
            url: 'STOCK_REQUETE.php',
            type: 'POST',
            data: {
                fonction: 'select',
                rq: "SELECT * FROM fournisseur Where DateArchiv IS NULL"
            },
            success: function (data) {
                console.log(data);
                var resultats = JSON.parse(data);
                console.log(resultats);

                var string = "<FONT face='arial'><div class='container'><CENTER>" +
                    "<div class='table'>" +

                    "<div class='header__item'> <a id='NomFourn'  class='filter__link' href='#'>Nom Fournisseur</a></div>" +
                    "<div class='header__item'> <a id='Adresse' class='filter__link' href='#'>Adresse</a></div>" +
                    "<div class='header__item'> <a id='CodePostal' class='filter__link' href='#'>CodePostal</a></div>" +
                    "<div class='header__item'> <a id='Ville' class='filter__link' href='#'>Ville</a></div>" +
                    "<div class='header__item'> <a id='Tel' class='filter__link' href='#'>Telephone</a></div>" +
                    "<div class='header__item'> <a id='Modif' class='filter__link' href='#'>Modifier</a></div>" +
                    "<div class='header__item'> <a id='Suppr' class='filter__link' href='#'>Suprimer</a></div>" +
                    "</div><div class='table-content'>";


                console.log(resultats[0]['NomProd']);


                for (let i = 0; i < resultats.length; i++) {
                    console.log('in loop: ' + i);

                    string += '<div class="table-row">'
                        + "<div class='table-data'>" + resultats[i]['NomFourn'] + "</div>"
                        + "<div class='table-data'>" + resultats[i]['AdresseFourn'] + "</div>"
                        + "<div class='table-data'>" + resultats[i]['CPFourni'] + "</div>"
                        + "<div class='table-data'>" + resultats[i]['VilleFourn'] + "</div>"
                        + "<div class='table-data'>" + resultats[i]['TelFourn'] + "</div>"
                        + "<div class='table-data'> <input type='image' id='image' class='inputImage' src = 'img/engrenage.png' width = '45px' height = '45px' onclick = 'modif()' ></input > </div > "
                        + "<div class='table-data'> <input type='image' id='image' class='inputImage'src = 'img/supprimer.png' width = '45px' height = '45px' onclick = 'suppressionFournisseur(this)' ></input > </div > "
                        + "</div > "
                        + "<div class= 'table-data' > ";

                }
                string += '</div>' + '</CENTER>' + '</div>' + '</FONT>';

                document.getElementById("tableauProduit").innerHTML = string;
                setupTab(['NomFourn', 'Adresse', 'CodePostal', 'Ville', 'Tel', 'Modif', 'Suppr']);
            },
            error: function (dataSQL, statut) {
                alert("error sqlConnect.js : " + dataSQL.erreur);
            }
        });

        function suppressionFournisseur(boutton) {

            let laDate = new Date();
            laDate = laDate.getFullYear() + "-" + (laDate.getMonth() + 1) + "-" + laDate.getDate();

            let row = boutton.parentNode.parentNode;
            let NomFourn = row.firstChild.innerHTML;

            let rq = "UPDATE fournisseur SET DateArchiv = '" + laDate + "' WHERE NomFourn = '" + NomFourn + "'";
            console.log(rq);

            $.ajax({
                url: 'STOCK_REQUETE.php',
                type: 'POST',
                data: {
                    fonction: 'Update',
                    rq: rq
                },
                success: function (data) {
                    //console.log(data);
                    location.reload();
                },
                error: function (dataSQL, statut) {
                    alert("error sqlConnect.js : " + dataSQL.erreur);
                }
            });
        }

        function modif() {
            location.href = 'Modification Fournisseur.html';
        }
    </script>

</body>

</html>